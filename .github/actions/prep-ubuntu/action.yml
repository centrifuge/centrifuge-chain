name: Prepare Ubuntu for Rust builds
description: cleanup and Rust Tools setup
inputs:
  cache:
    description: cache type (enabled if set)
    default: "disabled"
  GWIP:
    description: "Google Workload identity provider"
    default: ''
  GSA:
    description: "Google Service Account"
    default: ''
runs:
  using: composite
  steps:
    - name: Prep build on Ubuntu
      id: ubuntu_prep
      shell: sh
      run: |
        echo "Pre cleanup"
        df -h
        sudo rm -rf "/usr/local/share/boost"
        sudo rm -rf "$AGENT_TOOLSDIRECTORY"
        echo "Post cleanup"
        df -h
        sudo apt-get install protobuf-compiler
     
    - name: Install toolchain from rust-toolchain.toml
      shell: sh
      run: scripts/install_toolchain.sh

    - name: SCcache setup
      if: ${{ inputs.cache == 'enabled' }}
      uses: ./.github/actions/sccache-gcloud
      with:
        GWIP: ${{ inputs.GWIP }}
        GSA: ${{ inputs.GSA }}



